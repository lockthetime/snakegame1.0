<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂèØÁà±Ë¥™ÂêÉËõáÊ∏∏Êàè üêç</title>
    <style>
        /* ÂÖ®Â±ÄÊ†∑ÂºèÈáçÁΩÆÂíåÂü∫Á°ÄËÆæÁΩÆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* ‰∏ªÂÆπÂô® */
        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 95vw;
            height: 95vh;
            max-width: none;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            overflow: hidden;
        }

        /* Â∑¶‰æßÊ∏∏ÊàèÂå∫Âüü */
        .game-area-left {
            flex: 2;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        /* Âè≥‰æßÊéßÂà∂Âå∫Âüü */
        .controls-area-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 280px;
            max-width: 350px;
        }

        /* Ê†áÈ¢òÊ†∑Âºè */
        .title {
            font-size: 1.8em;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        /* ÂàÜÊï∞ÊòæÁ§∫ */
        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            gap: 10px;
        }

        .score-item {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 12px;
            border-radius: 12px;
            flex: 1;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.3);
        }

        .score-label {
            display: block;
            font-size: 0.75em;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .score-value {
            display: block;
            font-size: 1.2em;
            font-weight: 700;
        }

        /* ÈÄüÂ∫¶ÊéßÂà∂ */
        .speed-control {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .speed-label {
            display: block;
            font-size: 0.9em;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .speed-slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .speed-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .speed-mark {
            font-size: 0.8em;
            color: #666;
            font-weight: 500;
        }

        .speed-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 10px;
            border-radius: 10px;
            font-weight: 700;
            min-width: 35px;
            font-size: 0.9em;
        }

        /* Ê∏∏ÊàèÊåâÈíÆ */
        .game-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .game-btn {
            flex: 1;
            min-width: 100px;
            padding: 8px 12px;
            border: none;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .start-btn {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
            box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
        }

        .pause-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
        }

        .reset-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .mute-btn {
            background: linear-gradient(135deg, #ffa726, #ff7043);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 167, 38, 0.3);
        }

        .sound-btn {
            background: linear-gradient(135deg, #26c6da, #00acc1);
            color: white;
            box-shadow: 0 4px 15px rgba(38, 198, 218, 0.3);
        }

        .bgm-btn {
            background: linear-gradient(135deg, #ab47bc, #8e24aa);
            color: white;
            box-shadow: 0 4px 15px rgba(171, 71, 188, 0.3);
        }

        /* Èü≥È¢ëÊéßÂà∂Èù¢Êùø */
        .audio-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .audio-control-item {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 10px;
            width: 100%;
        }

        .audio-control-item .speed-label {
            font-size: 0.8em;
            margin-bottom: 6px;
        }

        .audio-control-item .speed-slider-container {
            gap: 8px;
        }

        .audio-control-item .speed-mark {
            font-size: 0.7em;
        }

        .audio-control-item .speed-display {
            padding: 4px 8px;
            font-size: 0.8em;
            min-width: 30px;
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .game-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Ê∏∏ÊàèÁîªÂ∏É */
        .canvas-container {
            position: relative;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }

        #gameCanvas {
            border: 3px solid #333;
            border-radius: 16px;
            background: #f0f8f0;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
        }

        /* Ê∏∏ÊàèÁªìÊùüË¶ÜÁõñÂ±Ç */
        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
        }

        .game-over-modal {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .game-over-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 15px;
        }

        .final-score {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .new-record {
            color: #56ab2f;
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 20px;
            display: none;
        }

        /* Êñ∞Á∫™ÂΩïÂ•ñÂä±ÂºπÁ™ó */
        .reward-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .reward-modal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
            position: relative;
            overflow: hidden;
        }

        .reward-modal::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .reward-title {
            font-size: 2em;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .reward-message {
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .developer-contact {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .contact-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .contact-number {
            font-size: 1.3em;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .reward-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reward-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Ê∏∏ÊàèËØ¥Êòé */
        .instructions {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 12px;
            text-align: left;
        }

        .instructions-title {
            font-size: 1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .instruction-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            background: white;
            border-radius: 6px;
        }

        .instruction-key {
            background: #333;
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 600;
        }

        .instruction-emoji {
            font-size: 1em;
        }

        .instruction-text {
            font-size: 0.8em;
            color: #666;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls-area-right {
                min-width: auto;
                max-width: none;
            }
            
            .audio-controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .audio-control-item {
                flex: 1;
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                width: 98vw;
                height: 98vh;
            }
            
            .title {
                font-size: 1.5em;
            }
            
            .game-controls {
                flex-direction: column;
                gap: 8px;
            }
            
            .game-btn {
                width: 100%;
            }
            
            .instruction-grid {
                grid-template-columns: 1fr;
            }
            
            #gameCanvas {
                max-width: 100%;
                max-height: 60vh;
            }
        }

        @media (max-width: 480px) {
            .score-board {
                gap: 8px;
            }
            
            .score-item {
                padding: 6px 10px;
            }
            
            .audio-controls {
                flex-direction: column;
            }
            
            .audio-control-item {
                flex: none;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Ê∏∏ÊàèÊ†áÈ¢ò -->
        <div style="text-align: center; margin-bottom: 15px;">
            <h1 class="title">üêç ÂèØÁà±Ë¥™ÂêÉËõá üçé</h1>
            <p class="subtitle">‰∫´ÂèóÁªèÂÖ∏Ê∏∏ÊàèÁöÑ‰πêË∂£ÂêßÔºÅ</p>
        </div>

        <!-- ÂàÜÊï∞ÊòæÁ§∫ -->
        <div class="score-board">
            <div class="score-item">
                <span class="score-label">ÂΩìÂâçÂàÜÊï∞</span>
                <span class="score-value" id="currentScore">0</span>
            </div>
            <div class="score-item">
                <span class="score-label">ÊúÄÈ´òÂàÜ</span>
                <span class="score-value" id="highScore">0</span>
            </div>
        </div>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <!-- Â∑¶‰æßÊ∏∏ÊàèÂå∫Âüü -->
            <div class="game-area-left">
                <!-- Ê∏∏ÊàèÁîªÂ∏É -->
                <div class="canvas-container">
                    <canvas id="gameCanvas" width="800" height="600"></canvas>
                    
                    <!-- Ê∏∏ÊàèÁªìÊùüË¶ÜÁõñÂ±Ç -->
                    <div class="game-over-overlay" id="gameOverOverlay">
                        <div class="game-over-modal">
                            <h2 class="game-over-title">üòµ Ê∏∏ÊàèÁªìÊùüÔºÅ</h2>
                            <div class="final-score">
                                ‰Ω†ÁöÑÂàÜÊï∞Ôºö<span id="finalScore">0</span>
                            </div>
                            <div class="new-record" id="newRecord">üéâ ÊÅ≠ÂñúÔºÅÊñ∞Á∫™ÂΩïÔºÅ</div>
                            <button id="restartBtn" class="game-btn start-btn">
                                <span>üéÆ</span>
                                ÂÜçÊù•‰∏ÄÂ±Ä
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥‰æßÊéßÂà∂Âå∫Âüü -->
            <div class="controls-area-right">
                <!-- Ê∏∏ÊàèÊéßÂà∂ÊåâÈíÆ -->
                <div class="game-controls">
                    <button id="startBtn" class="game-btn start-btn">
                        <span>üéÆ</span>
                        ÂºÄÂßãÊ∏∏Êàè
                    </button>
                    <button id="pauseBtn" class="game-btn pause-btn" disabled>
                        <span>‚è∏Ô∏è</span>
                        ÊöÇÂÅú
                    </button>
                    <button id="resetBtn" class="game-btn reset-btn">
                        <span>üîÑ</span>
                        ÈáçÊñ∞ÂºÄÂßã
                    </button>
                </div>

                <!-- ÈÄüÂ∫¶ÊéßÂà∂ -->
                <div class="speed-control">
                    <label for="speedSlider" class="speed-label">üöÄ Ê∏∏ÊàèÈÄüÂ∫¶ËÆæÁΩÆ</label>
                    <div class="speed-slider-container">
                        <span class="speed-mark">ÊÖ¢</span>
                        <input type="range" id="speedSlider" min="1" max="10" value="5" class="speed-slider">
                        <span class="speed-mark">Âø´</span>
                        <span class="speed-display" id="speedValue">5</span>
                    </div>
                </div>

                <!-- Èü≥È¢ëÊéßÂà∂ -->
                <div class="audio-controls">
                    <button id="soundToggle" class="game-btn sound-btn">
                        <span id="soundIcon">üîä</span>
                        <span id="soundText">Èü≥Êïà: ÂºÄÂêØ</span>
                    </button>
                    <button id="bgmToggle" class="game-btn bgm-btn">
                        <span id="bgmIcon">üéµ</span>
                        <span id="bgmText">Èü≥‰πê: ÂºÄÂêØ</span>
                    </button>
                    <button id="muteAllBtn" class="game-btn mute-btn">
                        <span id="muteIcon">üîä</span>
                        <span id="muteText">ÂÖ®Â±ÄÈùôÈü≥</span>
                    </button>
                </div>

                <!-- Ê∏∏ÊàèËØ¥Êòé -->
                <div class="instructions">
                    <h3 class="instructions-title">üéØ Ê∏∏ÊàèËØ¥Êòé</h3>
                    <div class="instruction-grid">
                        <div class="instruction-item">
                            <span class="instruction-key">‚Üë ‚Üì ‚Üê ‚Üí</span>
                            <span class="instruction-text">ÊéßÂà∂ÊñπÂêë</span>
                        </div>
                        <div class="instruction-item">
                            <span class="instruction-key">Á©∫Ê†º</span>
                            <span class="instruction-text">ÊöÇÂÅú/ÁªßÁª≠</span>
                        </div>
                        <div class="instruction-item">
                            <span class="instruction-emoji">üçé</span>
                            <span class="instruction-text">ÂêÉËãπÊûúÂæóÂàÜ</span>
                        </div>
                        <div class="instruction-item">
                            <span class="instruction-emoji">üí•</span>
                            <span class="instruction-text">ÈÅøÂÖçÁ¢∞Êíû</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êñ∞Á∫™ÂΩïÂ•ñÂä±ÂºπÁ™ó -->
    <div class="reward-overlay" id="rewardOverlay">
        <div class="reward-modal">
            <h2 class="reward-title">üéâ ÊÅ≠ÂñúÔºÅüéâ</h2>
            <div class="reward-message">
                ÂìáÔºå‰Ω†Â±ÖÁÑ∂ÂàõÈÄ†‰∫ÜÊñ∞ËÆ∞ÂΩïÔºÅ<br>
                Â•ñÂä±‰Ω†ÂºÄÂèëËÄÖËÅîÁ≥ªÊñπÂºèÔºö
            </div>
            <div class="developer-contact">
                <div class="contact-label">ÂºÄÂèëËÄÖÂæÆ‰ø°/ÁîµËØù</div>
                <div class="contact-number">19121393207</div>
            </div>
            <button class="reward-close-btn" id="rewardCloseBtn">ÊàëÁü•ÈÅì‰∫Ü</button>
        </div>
    </div>
    
    <script>
        // Ê∏∏ÊàèÂèòÈáè
        let canvas, ctx;
        let snake = [{x: 400, y: 300}];  // ËõáÁöÑÂàùÂßã‰ΩçÁΩÆÔºàÁîªÂ∏É‰∏≠ÂøÉÔºâ
        let direction = {x: 0, y: 0};    // ÁßªÂä®ÊñπÂêë
        let food = {};                    // È£üÁâ©‰ΩçÁΩÆ
        let score = 0;                    // ÂΩìÂâçÂàÜÊï∞
        let highScore = 0;                // ÊúÄÈ´òÂàÜ
        let gameRunning = false;          // Ê∏∏ÊàèÁä∂ÊÄÅ
        let gameLoop;                     // Ê∏∏ÊàèÂæ™ÁéØ
        let gameSpeed = 5;                // Ê∏∏ÊàèÈÄüÂ∫¶

        // ÁΩëÊ†ºÂ§ßÂ∞è
        const GRID_SIZE = 20;

        // Èü≥ÊïàÁ≥ªÁªü
        let audioContext;
        let soundEnabled = true;
        let bgmEnabled = true;
        let globalMuted = false;
        let bgmOscillator = null;
        let bgmGainNode = null;

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñÊ∏∏Êàè
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            setupEventListeners();
            loadHighScore();
            initAudio();
        });

        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // ÁîüÊàêÈöèÊú∫È£üÁâ©‰ΩçÁΩÆ
            generateFood();
            
            // ÁªòÂà∂ÂàùÂßãÊ∏∏ÊàèÁä∂ÊÄÅ
            drawGame();
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            // ÂºÄÂßãÊåâÈíÆ
            document.getElementById('startBtn').addEventListener('click', startGame);
            
            // ÊöÇÂÅúÊåâÈíÆ
            document.getElementById('pauseBtn').addEventListener('click', pauseGame);
            
            // ÈáçÁΩÆÊåâÈíÆ
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            
            // ÈáçÊñ∞ÂºÄÂßãÊåâÈíÆ
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            
            // ÈÄüÂ∫¶ÊªëÂùó
            const speedSlider = document.getElementById('speedSlider');
            speedSlider.addEventListener('input', function() {
                gameSpeed = parseInt(this.value);
                document.getElementById('speedValue').textContent = gameSpeed;
                
                // Â¶ÇÊûúÊ∏∏ÊàèÊ≠£Âú®ËøêË°åÔºåÊõ¥Êñ∞Ê∏∏ÊàèÂæ™ÁéØÈÄüÂ∫¶
                if (gameRunning) {
                    clearInterval(gameLoop);
                    startGameLoop();
                }
            });

            // Èü≥ÊïàÂºÄÂÖ≥
            const soundToggle = document.getElementById('soundToggle');
            soundToggle.addEventListener('click', function() {
                soundEnabled = !soundEnabled;
                document.getElementById('soundIcon').textContent = soundEnabled ? 'üîä' : 'üîá';
                document.getElementById('soundText').textContent = soundEnabled ? 'Èü≥Êïà: ÂºÄÂêØ' : 'Èü≥Êïà: ÂÖ≥Èó≠';
            });

            // ËÉåÊôØÈü≥‰πêÂºÄÂÖ≥
            const bgmToggle = document.getElementById('bgmToggle');
            bgmToggle.addEventListener('click', function() {
                bgmEnabled = !bgmEnabled;
                document.getElementById('bgmIcon').textContent = bgmEnabled ? 'üéµ' : 'üéµ';
                document.getElementById('bgmText').textContent = bgmEnabled ? 'Èü≥‰πê: ÂºÄÂêØ' : 'Èü≥‰πê: ÂÖ≥Èó≠';
                
                if (bgmEnabled && !globalMuted) {
                    startBackgroundMusic();
                } else {
                    stopBackgroundMusic();
                }
            });

            // ÂÖ®Â±ÄÈùôÈü≥ÊåâÈíÆ
            const muteAllBtn = document.getElementById('muteAllBtn');
            muteAllBtn.addEventListener('click', function() {
                globalMuted = !globalMuted;
                
                if (globalMuted) {
                    stopBackgroundMusic();
                    document.getElementById('muteIcon').textContent = 'üîá';
                    document.getElementById('muteText').textContent = 'ÂèñÊ∂àÈùôÈü≥';
                } else {
                    if (bgmEnabled) {
                        startBackgroundMusic();
                    }
                    document.getElementById('muteIcon').textContent = 'üîä';
                    document.getElementById('muteText').textContent = 'ÂÖ®Â±ÄÈùôÈü≥';
                }
            });

            // Â•ñÂä±ÂºπÁ™óÂÖ≥Èó≠ÊåâÈíÆ
            const rewardCloseBtn = document.getElementById('rewardCloseBtn');
            rewardCloseBtn.addEventListener('click', function() {
                document.getElementById('rewardOverlay').style.display = 'none';
            });
            
            // ÈîÆÁõòÊéßÂà∂
            document.addEventListener('keydown', handleKeyPress);
        }

        // Â§ÑÁêÜÈîÆÁõòÊåâÈîÆ
        function handleKeyPress(event) {
            // ÈòªÊ≠¢ÊñπÂêëÈîÆÂíåÁ©∫Ê†ºÈîÆÁöÑÈªòËÆ§Ë°å‰∏∫ÔºåÈò≤Ê≠¢È°µÈù¢ÊªöÂä®
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' ', 'Space'].includes(event.key)) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            if (!gameRunning && event.key !== ' ' && event.key !== 'Space') return;
            
            switch(event.key) {
                case 'ArrowUp':
                    if (direction.y === 0) {
                        direction = {x: 0, y: -GRID_SIZE};
                        playMoveSound();
                    }
                    break;
                case 'ArrowDown':
                    if (direction.y === 0) {
                        direction = {x: 0, y: GRID_SIZE};
                        playMoveSound();
                    }
                    break;
                case 'ArrowLeft':
                    if (direction.x === 0) {
                        direction = {x: -GRID_SIZE, y: 0};
                        playMoveSound();
                    }
                    break;
                case 'ArrowRight':
                    if (direction.x === 0) {
                        direction = {x: GRID_SIZE, y: 0};
                        playMoveSound();
                    }
                    break;
                case ' ':
                case 'Space':
                    if (gameRunning) {
                        pauseGame();
                    } else {
                        startGame();
                    }
                    break;
            }
        }

        // ÂºÄÂßãÊ∏∏Êàè
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                document.getElementById('startBtn').disabled = true;
                document.getElementById('pauseBtn').disabled = false;
                
                // Êí≠ÊîæÂºÄÂßãÈü≥Êïà
                playStartSound();
                
                // ÂêØÂä®ËÉåÊôØÈü≥‰πê
                if (bgmEnabled && !globalMuted) {
                    startBackgroundMusic();
                }
                
                // Â¶ÇÊûúËõáËøòÊ≤°ÊúâÁßªÂä®ÊñπÂêëÔºåËÆæÁΩÆÈªòËÆ§ÂêëÂè≥
                if (direction.x === 0 && direction.y === 0) {
                    direction = {x: GRID_SIZE, y: 0};
                }
                
                startGameLoop();
            }
        }

        // ÊöÇÂÅúÊ∏∏Êàè
        function pauseGame() {
            gameRunning = false;
            clearInterval(gameLoop);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            // Êí≠ÊîæÊöÇÂÅúÈü≥Êïà
            playPauseSound();
        }

        // ÈáçÁΩÆÊ∏∏Êàè
        function resetGame() {
            pauseGame();
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            snake = [{x: 400, y: 300}];
            direction = {x: 0, y: 0};
            score = 0;
            
            // Êõ¥Êñ∞UI
            document.getElementById('currentScore').textContent = score;
            
            // ÈöêËóèÊ∏∏ÊàèÁªìÊùüÁîªÈù¢
            document.getElementById('gameOverOverlay').style.display = 'none';
            
            // ÁîüÊàêÊñ∞È£üÁâ©
            generateFood();
            drawGame();
        }

        // ÈáçÊñ∞ÂºÄÂßãÊ∏∏Êàè
        function restartGame() {
            resetGame();
            startGame();
        }

        // ÂºÄÂßãÊ∏∏ÊàèÂæ™ÁéØ
        function startGameLoop() {
            // Ê†πÊçÆÈÄüÂ∫¶ËÆ°ÁÆóÂª∂ËøüÊó∂Èó¥ÔºàÈÄüÂ∫¶Ë∂äÈ´òÔºåÂª∂ËøüË∂äÁü≠Ôºâ
            const delay = 200 - (gameSpeed - 1) * 15; // ÈÄüÂ∫¶1: 185ms, ÈÄüÂ∫¶10: 65ms
            gameLoop = setInterval(updateGame, delay);
        }

        // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
        function updateGame() {
            if (!gameRunning) return;
            
            // ÁßªÂä®ËõáÂ§¥
            const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
            
            // Ê£ÄÊü•Á¢∞Êíû
            if (checkCollision(head)) {
                gameOver();
                return;
            }
            
            snake.unshift(head);
            
            // Ê£ÄÊü•ÊòØÂê¶ÂêÉÂà∞È£üÁâ©
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                document.getElementById('currentScore').textContent = score;
                generateFood();
                
                // Êí≠ÊîæÂêÉÈ£üÁâ©Èü≥Êïà
                playEatSound();
            } else {
                snake.pop();
            }
            
            drawGame();
        }

        // Ê£ÄÊü•Á¢∞Êíû
        function checkCollision(head) {
            // Ê£ÄÊü•Â¢ôÂ£ÅÁ¢∞Êíû
            if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
                return true;
            }
            
            // Ê£ÄÊü•Ëá™Ë∫´Á¢∞Êíû
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    return true;
                }
            }
            
            return false;
        }

        // ÁîüÊàêÈöèÊú∫È£üÁâ©‰ΩçÁΩÆ
        function generateFood() {
            let validPosition = false;
            
            while (!validPosition) {
                food = {
                    x: Math.floor(Math.random() * (canvas.width / GRID_SIZE)) * GRID_SIZE,
                    y: Math.floor(Math.random() * (canvas.height / GRID_SIZE)) * GRID_SIZE
                };
                
                // Á°Æ‰øùÈ£üÁâ©‰∏çÂú®ËõáË∫´‰∏ä
                validPosition = true;
                for (let segment of snake) {
                    if (food.x === segment.x && food.y === segment.y) {
                        validPosition = false;
                        break;
                    }
                }
            }
        }

        // ÁªòÂà∂Ê∏∏ÊàèÁîªÈù¢
        function drawGame() {
            // Ê∏ÖÁ©∫ÁîªÂ∏É
            ctx.fillStyle = '#f0f8f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ÁªòÂà∂ÁΩëÊ†ºÁ∫ø
            drawGrid();
            
            // ÁªòÂà∂Ëõá
            drawSnake();
            
            // ÁªòÂà∂È£üÁâ©
            drawFood();
        }

        // ÁªòÂà∂ÁΩëÊ†ºÁ∫ø
        function drawGrid() {
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            // ÁªòÂà∂ÂûÇÁõ¥Á∫ø
            for (let x = 0; x <= canvas.width; x += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // ÁªòÂà∂Ê∞¥Âπ≥Á∫ø
            for (let y = 0; y <= canvas.height; y += GRID_SIZE) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        // ÁªòÂà∂Ëõá
        function drawSnake() {
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // ËõáÂ§¥ - Êõ¥‰∫ÆÁöÑÁªøËâ≤
                    ctx.fillStyle = '#4CAF50';
                } else {
                    // ËõáË∫´ - ËæÉÊ∑±ÁöÑÁªøËâ≤
                    ctx.fillStyle = '#81C784';
                }
                
                // ÁªòÂà∂ÂúÜËßíÁü©ÂΩ¢
                drawRoundedRect(segment.x + 1, segment.y + 1, GRID_SIZE - 2, GRID_SIZE - 2, 4);
                
                // Â¶ÇÊûúÊòØËõáÂ§¥ÔºåÁªòÂà∂ÁúºÁùõ
                if (index === 0) {
                    ctx.fillStyle = '#2E7D32';
                    const eyeSize = 3;
                    const eyeOffset = 6;
                    
                    // Ê†πÊçÆÁßªÂä®ÊñπÂêëË∞ÉÊï¥ÁúºÁùõ‰ΩçÁΩÆ
                    if (direction.x > 0) { // ÂêëÂè≥
                        ctx.fillRect(segment.x + 12, segment.y + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x + 12, segment.y + 12, eyeSize, eyeSize);
                    } else if (direction.x < 0) { // ÂêëÂ∑¶
                        ctx.fillRect(segment.x + 5, segment.y + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x + 5, segment.y + 12, eyeSize, eyeSize);
                    } else if (direction.y > 0) { // Âêë‰∏ã
                        ctx.fillRect(segment.x + 5, segment.y + 12, eyeSize, eyeSize);
                        ctx.fillRect(segment.x + 12, segment.y + 12, eyeSize, eyeSize);
                    } else if (direction.y < 0) { // Âêë‰∏ä
                        ctx.fillRect(segment.x + 5, segment.y + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x + 12, segment.y + 5, eyeSize, eyeSize);
                    } else { // ÈªòËÆ§Áä∂ÊÄÅ
                        ctx.fillRect(segment.x + 6, segment.y + 5, eyeSize, eyeSize);
                        ctx.fillRect(segment.x + 11, segment.y + 5, eyeSize, eyeSize);
                    }
                }
            });
        }

        // ÁªòÂà∂È£üÁâ©ÔºàËãπÊûúÊ†∑ÂºèÔºâ
        function drawFood() {
            // ËãπÊûú‰∏ª‰Ωì - Á∫¢Ëâ≤
            ctx.fillStyle = '#F44336';
            drawRoundedRect(food.x + 2, food.y + 4, GRID_SIZE - 4, GRID_SIZE - 6, 6);
            
            // ËãπÊûúËåé - Ê£ïËâ≤
            ctx.fillStyle = '#8D6E63';
            ctx.fillRect(food.x + 9, food.y + 1, 2, 4);
            
            // ËãπÊûúÂè∂Â≠ê - ÁªøËâ≤
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(food.x + 11, food.y + 1, 4, 2);
            
            // ËãπÊûúÈ´òÂÖâ
            ctx.fillStyle = '#FFCDD2';
            ctx.fillRect(food.x + 5, food.y + 6, 3, 3);
        }

        // ÁªòÂà∂ÂúÜËßíÁü©ÂΩ¢
        function drawRoundedRect(x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }

        // Ê∏∏ÊàèÁªìÊùü
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            
            // Êí≠ÊîæÊ∏∏ÊàèÁªìÊùüÈü≥Êïà
            playGameOverSound();
            
            // Êõ¥Êñ∞ÊúÄÈ´òÂàÜ
            if (score > highScore) {
                highScore = score;
                document.getElementById('highScore').textContent = highScore;
                document.getElementById('newRecord').style.display = 'block';
                saveHighScore();
                
                // Êí≠ÊîæÊñ∞Á∫™ÂΩïÈü≥Êïà
                setTimeout(() => playNewRecordSound(), 500);
                
                // ÊòæÁ§∫Â•ñÂä±ÂºπÁ™óÔºàÂª∂Ëøü1.5ÁßíÂêéÊòæÁ§∫Ôºâ
                setTimeout(() => {
                    document.getElementById('rewardOverlay').style.display = 'flex';
                }, 1500);
            } else {
                document.getElementById('newRecord').style.display = 'none';
            }
            
            // ÊòæÁ§∫Ê∏∏ÊàèÁªìÊùüÁîªÈù¢
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverOverlay').style.display = 'flex';
            
            // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        // ‰øùÂ≠òÊúÄÈ´òÂàÜÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveHighScore() {
            localStorage.setItem('snakeHighScore', highScore);
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊúÄÈ´òÂàÜ
        function loadHighScore() {
            const saved = localStorage.getItem('snakeHighScore');
            if (saved) {
                highScore = parseInt(saved);
                document.getElementById('highScore').textContent = highScore;
            }
        }

        // ÂàùÂßãÂåñÈü≥È¢ë‰∏ä‰∏ãÊñá
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Web Audio API not supported');
                soundEnabled = false;
            }
        }

        // ÂàõÂª∫Èü≥Êïà
        function createBeep(frequency, duration, type = 'sine') {
            if (!soundEnabled || !audioContext || globalMuted) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // ÂºÄÂßãËÉåÊôØÈü≥‰πêÔºàÈí¢Áê¥È£éÊ†º - Âç°ÂÜúÂÆåÊï¥ÁâàÔºâ
        function startBackgroundMusic() {
            if (!audioContext || !bgmEnabled || globalMuted) return;
            
            // ÂÅúÊ≠¢‰πãÂâçÁöÑËÉåÊôØÈü≥‰πê
            stopBackgroundMusic();
            
            // Âç°ÂÜú Canon in D ÂÆåÊï¥ÊóãÂæãÔºàÊõ¥‰ºòÁæéÁöÑÁâàÊú¨Ôºâ
            const melody = [
                // Á¨¨‰∏ÄÊÆµ
                293.66, 220.00, 246.94, 261.63, 293.66, 220.00, 246.94, 293.66,
                // Á¨¨‰∫åÊÆµ  
                329.63, 293.66, 329.63, 369.99, 329.63, 293.66, 329.63, 293.66,
                // Á¨¨‰∏âÊÆµ
                369.99, 329.63, 369.99, 392.00, 369.99, 329.63, 293.66, 329.63,
                // Á¨¨ÂõõÊÆµ
                293.66, 246.94, 220.00, 246.94, 293.66, 329.63, 369.99, 392.00,
                // Á¨¨‰∫îÊÆµÔºàÈ´òÊΩÆÔºâ
                440.00, 392.00, 440.00, 493.88, 440.00, 392.00, 369.99, 392.00,
                // Á¨¨ÂÖ≠ÊÆµ
                369.99, 329.63, 293.66, 329.63, 369.99, 392.00, 440.00, 392.00,
                // ÁªìÂ∞æ
                369.99, 329.63, 293.66, 261.63, 293.66, 220.00, 246.94, 293.66
            ];
            
            const noteDurations = [
                // Êõ¥‰∏∞ÂØåÁöÑËäÇÊãçÂèòÂåñ
                1.0, 0.5, 0.5, 1.0, 1.0, 0.5, 0.5, 1.5,
                1.0, 0.5, 0.5, 1.0, 1.0, 0.5, 0.5, 1.5,
                1.0, 0.5, 0.5, 1.0, 1.0, 0.5, 0.5, 1.0,
                1.0, 0.5, 0.5, 1.0, 0.75, 0.75, 0.75, 0.75,
                1.5, 0.5, 1.0, 1.0, 1.0, 0.5, 0.5, 1.0,
                1.0, 0.5, 0.5, 1.0, 0.75, 0.75, 0.75, 0.75,
                1.0, 0.5, 0.5, 1.0, 1.0, 0.5, 0.5, 2.0
            ];
            let noteIndex = 0;
            let isPlaying = true;
            
            function playPianoNote(frequency, duration) {
                if (!isPlaying || globalMuted || !bgmEnabled) return;
                
                // ÂàõÂª∫Èí¢Áê¥Èü≥Ëâ≤ÁöÑÂ§çÂêàÊ≥¢ÂΩ¢
                const fundamental = audioContext.createOscillator();
                const harmonic2 = audioContext.createOscillator();
                const harmonic3 = audioContext.createOscillator();
                
                const gainNode = audioContext.createGain();
                const gain2 = audioContext.createGain();
                const gain3 = audioContext.createGain();
                const masterGain = audioContext.createGain();
                
                // ËÆæÁΩÆÈ¢ëÁéáÔºàÂü∫È¢ëÂíåË∞êÊ≥¢Ôºâ
                fundamental.frequency.value = frequency;
                harmonic2.frequency.value = frequency * 2;
                harmonic3.frequency.value = frequency * 3;
                
                // ËÆæÁΩÆÈü≥Ëâ≤Á±ªÂûã
                fundamental.type = 'sine';
                harmonic2.type = 'sine';
                harmonic3.type = 'triangle';
                
                // ËøûÊé•Èü≥È¢ëËäÇÁÇπ
                fundamental.connect(gainNode);
                harmonic2.connect(gain2);
                harmonic3.connect(gain3);
                
                gainNode.connect(masterGain);
                gain2.connect(masterGain);
                gain3.connect(masterGain);
                masterGain.connect(audioContext.destination);
                
                // ËÆæÁΩÆÈü≥ÈáèÊØî‰æãÔºàÊ®°ÊãüÈí¢Áê¥Èü≥Ëâ≤Ôºâ
                const now = audioContext.currentTime;
                const volume = 0.015; // ËÉåÊôØÈü≥‰πêÈü≥Èáè
                
                gainNode.gain.setValueAtTime(volume, now);
                gain2.gain.setValueAtTime(volume * 0.3, now);
                gain3.gain.setValueAtTime(volume * 0.1, now);
                
                // Èí¢Áê¥ÂåÖÁªúÔºàADSRÔºâ
                masterGain.gain.setValueAtTime(0, now);
                masterGain.gain.linearRampToValueAtTime(1, now + 0.1); // Attack
                masterGain.gain.exponentialRampToValueAtTime(0.7, now + 0.2); // Decay
                masterGain.gain.setValueAtTime(0.7, now + duration - 0.3); // Sustain
                masterGain.gain.exponentialRampToValueAtTime(0.01, now + duration); // Release
                
                // ÂêØÂä®ÊåØËç°Âô®
                fundamental.start(now);
                harmonic2.start(now);
                harmonic3.start(now);
                
                // ÂÅúÊ≠¢ÊåØËç°Âô®
                fundamental.stop(now + duration);
                harmonic2.stop(now + duration);
                harmonic3.stop(now + duration);
            }
            
            function playMelody() {
                if (!isPlaying || globalMuted || !bgmEnabled) return;
                
                const frequency = melody[noteIndex];
                const duration = noteDurations[noteIndex];
                
                playPianoNote(frequency, duration);
                
                noteIndex = (noteIndex + 1) % melody.length;
                
                setTimeout(playMelody, duration * 1000);
            }
            
            // Â≠òÂÇ®Êí≠ÊîæÁä∂ÊÄÅÔºåÁî®‰∫éÂÅúÊ≠¢
            bgmOscillator = { stop: () => { isPlaying = false; } };
            
            playMelody();
        }

        // ÂÅúÊ≠¢ËÉåÊôØÈü≥‰πê
        function stopBackgroundMusic() {
            if (bgmOscillator) {
                try {
                    bgmOscillator.stop();
                } catch (e) {
                    // ÂøΩÁï•Â∑≤ÁªèÂÅúÊ≠¢ÁöÑÊåØËç°Âô®ÈîôËØØ
                }
                bgmOscillator = null;
            }
            if (bgmGainNode) {
                bgmGainNode = null;
            }
        }

        // Êí≠ÊîæÁßªÂä®Èü≥Êïà
        function playMoveSound() {
            createBeep(200, 0.1, 'square');
        }

        // Êí≠ÊîæÂêÉÈ£üÁâ©Èü≥Êïà
        function playEatSound() {
            createBeep(400, 0.2, 'sine');
            setTimeout(() => createBeep(600, 0.1, 'sine'), 100);
        }

        // Êí≠ÊîæÊ∏∏ÊàèÁªìÊùüÈü≥Êïà
        function playGameOverSound() {
            createBeep(150, 0.3, 'sawtooth');
            setTimeout(() => createBeep(100, 0.3, 'sawtooth'), 150);
            setTimeout(() => createBeep(75, 0.5, 'sawtooth'), 300);
        }

        // Êí≠ÊîæÊ∏∏ÊàèÂºÄÂßãÈü≥Êïà
        function playStartSound() {
            createBeep(300, 0.1, 'sine');
            setTimeout(() => createBeep(400, 0.1, 'sine'), 100);
            setTimeout(() => createBeep(500, 0.2, 'sine'), 200);
        }

        // Êí≠ÊîæÊöÇÂÅúÈü≥Êïà
        function playPauseSound() {
            createBeep(250, 0.2, 'triangle');
        }

        // Êí≠ÊîæÊñ∞Á∫™ÂΩïÈü≥Êïà
        function playNewRecordSound() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createBeep(400 + i * 100, 0.15, 'sine');
                }, i * 100);
            }
        }
    </script>
</body>
</html>
